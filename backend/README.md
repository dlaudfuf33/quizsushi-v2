
# ğŸ£ QuizSushi - Backend
<p >
  <img width="800" height="500" alt="QuizSushi ë©”ì¸ í™”ë©´" src="https://github.com/user-attachments/assets/336586b3-5ab2-41c4-b246-87ff26d2adda" />
</p>   
ìê²©ì¦ ê³µë¶€ë¥¼ í•˜ë©° ê¸°ì¶œë¬¸ì œë¥¼ ë°˜ë³µí•´ì„œ í’€ê³ ë‹¤ ë°˜ë³µ íšŸìˆ˜ê°€ ëŠ˜ì–´ë‚ ìˆ˜ë¡ ì§€ë£¨í•˜ê²Œ ëŠê»´ì¡Œê³      

ê¸°ì¶œë¬¸ì œë¥¼ ì°¾ê³  ì •ë¦¬í•˜ëŠ” ë° ì˜¤íˆë ¤ ì‹œê°„ì´ ë‚­ë¹„ë˜ê³  ìˆë‹¤ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.

**ë‹¨ìˆœíˆ ë¬¸ì œë¥¼ í‘¸ëŠ” ê²ƒë³´ë‹¤, ì§ì ‘ ë§Œë“¤ì–´ë³´ëŠ” ê³¼ì •ì´ í›¨ì”¬ ë” ê¹Šì€ ì´í•´ê°€ ë  ìˆ˜ ìˆë‹¤ëŠ”** ìƒê°ì„í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.  
**ë” ë‹¤ì–‘í•œ ë¬¸ì œë¥¼ ì ‘í•˜ê³ , ëŠ¥ë™ì ìœ¼ë¡œ í•™ìŠµí•  ìˆ˜ ìˆëŠ” ë°©ë²•ì´ í•„ìš”í•˜ë‹¤ê³ ** ëŠë‚€ ê²ƒì´ QuizSushiì˜ ì‹œì‘ì´ì—ˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ê¸°ì¡´ í€´ì¦ˆ í”Œë«í¼ë“¤ì€ ë‹¤ìŒê³¼ ê°™ì€ í•œê³„ê°€ ìˆì—ˆìŠµë‹ˆë‹¤.  
- ì‚¬ìš©ìê°€ ë¬¸ì œë¥¼ ì§ì ‘ ë§Œë“¤ê³  ê³µìœ í•˜ê¸° ì–´ë µê³   
- AIë‚˜ ì‹¤ì‹œê°„ ê²½ìŸ ìš”ì†Œê°€ ì—†ìœ¼ë©°  
- ì‚¬ìš©ì ê°„ í”¼ë“œë°±ì´ë‚˜ ì§€ì‹ íë¦„ë„ ì›í™œí•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

> â€œë¬¸ì œë¥¼ ì—¬ëŸ¿ì´ì„œ í’€ì–´ë³´ë©´ ì–´ë–¨ê¹Œ?â€  
> â€œAIê°€ ë§Œë“¤ì–´ì£¼ëŠ” ë¬¸ì œë¥¼ ë°”ë¡œ í’€ ìˆ˜ëŠ” ì—†ì„ê¹Œ?â€  
> â€œë‚´ê°€ ë§Œë“  ë¬¸ì œë¥¼ ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ í‘¸ëŠ” ê±¸ í™•ì¸í•˜ë©´ ë” ì¬ë°Œì§€ ì•Šì„ê¹Œ?â€

ì´ëŸ¬í•œ ê³ ë¯¼ì„ í•´ê²°í•˜ê³ ì **QuizSushi**ë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.  
ì‚¬ìš©ìê°€ ì§ì ‘ í€´ì¦ˆë¥¼ ë§Œë“¤ê³  í’€ë©° ì§€ì‹ì„ ë‚˜ëˆ„ëŠ” í”Œë«í¼ìœ¼ë¡œ  
**AI ê¸°ë°˜ ë¬¸ì œ ìƒì„±**, ~~ì‹¤ì‹œê°„ ì„œë°”ì´ë²Œ í€´ì¦ˆ ì±Œë¦°ì§€ë¥¼~~ í†µí•´  
**í˜¼ìë§Œì´ ì•„ë‹Œ, í•¨ê»˜ í•™ìŠµí•˜ëŠ” ê²½í—˜ì„** ì œê³µí•©ë‹ˆë‹¤.


<br>   


### ğŸ“‚ ê´€ë ¨ ë§í¬

- ğŸ”— **Frontend Repository**: [quizsushi-fe (Next.js)](https://github.com/dlaudfuf33/quizsushi-fe)
- ğŸš€ **ë°°í¬ ì£¼ì†Œ**: [https://quizsushi.cmdlee.com](https://quizsushi.cmdlee.com)


---

## ğŸ› ï¸ ì‚¬ìš© ê¸°ìˆ 

| ì¹´í…Œê³ ë¦¬ | ë¼ì´ë¸ŒëŸ¬ë¦¬ | ì„¤ëª… |
| :--- | :--- | :--- |
| **Framework**       | Spring Boot (v3.2.5)          | Spring ê¸°ë°˜ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë ˆì„ì›Œí¬ |
|                     | Spring Data JPA               | ORM ê¸°ë°˜ DB ì—°ë™ |
|                     | Spring AI                     | Springì—ì„œ AI API ì—°ë™ì„ ìœ„í•œ í†µí•© ì¶”ìƒí™” |
|                     | Spring Security               | ì¸ì¦/ì¸ê°€ í”„ë ˆì„ì›Œí¬ |
|                     | Spring OAuth2 Client          | Google, Kakao ì†Œì…œ ë¡œê·¸ì¸ ì—°ë™ |
| **Security**        | JWT (io.jsonwebtoken)         | JSON Web Token ê¸°ë°˜ ì¸ì¦ ë° ì¸ê°€ |
|                     | Refresh Token + Redis         | IP + User-Agent ê¸°ë°˜ ë¦¬í”„ë ˆì‹œ í† í° ì‹ë³„ ë° ìƒíƒœ ê´€ë¦¬ |
| **Database**        | PostgreSQL                    | ë©”ì¸ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ |
|                     | Redis                         | ìºì‹œ, ì‹¤ì‹œê°„ ì±Œë¦°ì§€ ì„¸ì…˜, í† í° ì €ì¥ |
| **Infrastructure**  | NGINX                         | ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ë° HTTPS ì¸ì¦ ì²˜ë¦¬ |
|                     | MinIO                         | S3 í˜¸í™˜ ì˜¤ë¸Œì íŠ¸ ìŠ¤í† ë¦¬ì§€ |
|                     | Docker                        | ì»¨í…Œì´ë„ˆ í™˜ê²½ êµ¬ì„± ë° ë°°í¬ |
|                     | GitHub Actions                | GitHub ê¸°ë°˜ ë°°í¬ ìë™í™” ì›Œí¬í”Œë¡œìš° êµ¬ì„± |
| **AI**  | Vertex AI Gemini              | Google Cloudì˜ ìƒì„±í˜• AI ëª¨ë¸ |
|                     | Ollama                        | ë¡œì»¬ í™˜ê²½ì—ì„œì˜ ê²½ëŸ‰ ìƒì„±í˜• AI í†µí•© |
| **Documentation**   | SpringDoc OpenAPI             | Swagger v3 ê¸°ë°˜ API ëª…ì„¸ ìë™í™” |
| **Build Tool**      | Gradle                        | ì˜ì¡´ì„± ê´€ë¦¬ ë° ë¹Œë“œ ë„êµ¬ |

<br>   



## ğŸ“œ ì•„í‚¤íƒì²˜
<img width="882" height="575" alt="qst drawio" src="https://github.com/user-attachments/assets/d76a7904-a211-490a-9b15-58900a51cb5c" />



---

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

- **AI í€´ì¦ˆ ìƒì„±**: í…ìŠ¤íŠ¸ë§Œìœ¼ë¡œ ê°„í¸í•˜ê²Œ ê°ê´€ì‹, ì£¼ê´€ì‹ í€´ì¦ˆë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ì‹¤ì‹œê°„ ì„œë°”ì´ë²Œ í€´ì¦ˆ ì±Œë¦°ì§€**: ì—¬ëŸ¬ ì‚¬ìš©ìì™€ í•¨ê»˜ ì°¸ì—¬í•˜ëŠ” ì‹¤ì‹œê°„ í€´ì¦ˆ ëŒ€ê²° ê¸°ëŠ¥.
- **ì‚¬ìš©ì ìƒì„± í€´ì¦ˆ**: ëˆ„êµ¬ë‚˜ ìì‹ ë§Œì˜ í€´ì¦ˆë¥¼ ë§Œë“¤ì–´ ê³µìœ í•˜ê³ , ë‹¤ë¥¸ ì‚¬ìš©ìì˜ í€´ì¦ˆë¥¼ í’€ì´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ì•ˆì „í•œ ì¸ì¦ ì‹œìŠ¤í…œ**: OAuth2 ì†Œì…œ ë¡œê·¸ì¸ + JWT ê¸°ë°˜ ì¸ì¦ìœ¼ë¡œ ë³´ì•ˆê³¼ í¸ì˜ì„±ì„ ëª¨ë‘ í™•ë³´.
- **ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ**: ì‚¬ìš©ì/ë¬¸ì œ/ì‹ ê³  í†µê³„ ë“±ì„ ì‹œê°í™”í•˜ì—¬ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ì „ìš© í˜ì´ì§€.
- **MinIO ê¸°ë°˜ ë¯¸ë””ì–´ ê´€ë¦¬**: í€´ì¦ˆì— í¬í•¨ë˜ëŠ” ì´ë¯¸ì§€, ì˜ìƒ ë“±ì„ ê°ì²´ ìŠ¤í† ë¦¬ì§€ ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.

<br>



## ğŸ“ ì£¼ìš” ì‚¬í•­

### íŒ©í† ë¦¬ íŒ¨í„´ ë„ì… ([QuizFactory](https://github.com/dlaudfuf33/quizsushi-be/blob/main/src/main/java/com/cmdlee/quizsushi/quiz/domain/factory/DefaultQuizFactory.java): / [QuestionFactory](https://github.com/dlaudfuf33/quizsushi-be/blob/main/src/main/java/com/cmdlee/quizsushi/quiz/domain/factory/QuizQuestionFactory.java))
í€´ì¦ˆ ìƒì„± ì‹œ í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° ì „ë‹¬ë°›ì€ ë°ì´í„°ê°€ ë³µì¡í•œ êµ¬ì¡°(í€´ì¦ˆ ë³¸ë¬¸, ë‹¤ìˆ˜ì˜ ë¬¸ì œ, ê° ë¬¸ì œì˜ ì„ íƒì§€ ë° ì •ë‹µ)ë¡œ ì´ë£¨ì–´ì ¸ ìˆì—ˆê³ , ì´ë¥¼ ì—”í‹°í‹°ë¡œ ë§¤í•‘í•˜ëŠ” ê³¼ì •ì—ì„œ ì„œë¹„ìŠ¤ ê³„ì¸µì˜ ì±…ì„ì´ ì»¸ìŠµë‹ˆë‹¤.
- ê°ì²´ ìƒì„± ì±…ì„ì„ ëª…í™•íˆ ë¶„ë¦¬í•˜ê³ , ë¬¸ì œ ë²ˆí˜¸ ì¤‘ë³µê³¼ ê°™ì€ ë„ë©”ì¸ ê·œì¹™ì„ ì™¸ë¶€ì— ë…¸ì¶œí•˜ì§€ ì•Šê¸° ìœ„í•´ íŒ©í† ë¦¬ íŒ¨í„´ì„ ë„ì…í•˜ì˜€ìŠµë‹ˆë‹¤. QuizFactory / QuestionFactoryë¥¼ í†µí•´ ìƒì„± ê³¼ì •ì„ ìº¡ìŠí™”í•˜ê³ , ì„œë¹„ìŠ¤ëŠ” ì „ì²˜ë¦¬ëœ ë°ì´í„°ë¥¼ ì „ë‹¬ë§Œ í•˜ë„ë¡ êµ¬ì¡°ë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.
- ì´ë ‡ê²Œ í•¨ìœ¼ë¡œì¨ ìƒì„± ë¡œì§ì´ ê° ê°ì²´ ë‚´ë¶€ì— ì‘ì§‘ë˜ì—ˆê³ , í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ë‹¨ìœ„ë¡œ ë¶„ë¦¬ë˜ì—ˆìœ¼ë©°, ì „ì²´ ì„œë¹„ìŠ¤ ì½”ë“œì˜ ê°€ë…ì„±ê³¼ ìœ ì§€ë³´ìˆ˜ì„±ì´ í¬ê²Œ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.

<details>
<summary> íŒ©í† ë¦¬ íŒ¨í„´ ë„ì… ì´ì „ ì½”ë“œ ë³´ê¸°</summary>
  
```java
@Transactional
public void createQuiz(CreateQuizRequest request, Long memberId) {
        QuizsushiMember member = memberRepository.findById(memberId).orElseThrow(() -> new GlobalException(ErrorCode.ENTITY_NOT_FOUND));
        Category category = categoryRepository.findById(request.getCategoryId()).orElseThrow(() -> new GlobalException(ErrorCode.ENTITY_NOT_FOUND));
        String mediaKey = NanoIdUtils.randomNanoId();
        Quiz quiz = Quiz.builder()
            .creator(member)
            .title(request.getTitle())
            .category(category)
            .description(request.getDescription())
            .useSubject(request.isUseSubject())
            .mediaKey(mediaKey)
            .questionCount(request.getQuestions().size())
            .build();

        for (CreateQuestionRequest qReq : request.getQuestions()) {
            Question question = Question.builder()
                    .no(qReq.getNo())
                    .subject(qReq.getSubject())
                    .type(qReq.getType())
                    .questionText(qReq.getQuestion())
                    .options(qReq.getOptions())
                    .correctIndexes(qReq.getCorrectAnswer())
                    .correctAnswerText(qReq.getCorrectAnswerText())
                    .explanation(qReq.getExplanation())
                    .build();
                                
            quiz.addQuestions(question);
        }
        quizRepository.save(quiz);
    }
```
</details>

<details>
<summary> íŒ©í† ë¦¬ íŒ¨í„´ ì ìš© ì´í›„ ì½”ë“œ ë³´ê¸°</summary>

```java
@Transactional
    public CreatedQuizResponse createQuiz(CreateQuizRequest request, Long memberId) {
        QuizsushiMember member = memberRepository.findById(memberId).orElseThrow(() -> new GlobalException(ErrorCode.ENTITY_NOT_FOUND));

        Category category = categoryRepository.findById(request.getCategoryId()).orElseThrow(() -> new GlobalException(ErrorCode.ENTITY_NOT_FOUND));
        String mediaKey = NanoIdUtils.randomNanoId();

        QuizCreationData data = quizPreprocessingService.process(request, member, category, mediaKey);
        Quiz quiz = quizFactory.create(data);
        quizRepository.save(quiz);

        List<QuestionCreationData> questionDataList = questionPreprocessingService.processForCreate(request.getQuestions(), quiz.isUseSubject(), mediaKey);
        List<Question> questions = questionDataList.stream().map(qData -> questionFactory.create(qData, quiz)).toList();
        questionRepository.saveAll(questions);
        return new CreatedQuizResponse(quiz.getId());
    }
```
</details>

<img width="800" height="600"  alt="createQuiz" src="https://github.com/user-attachments/assets/6caabc91-bea7-4c26-a4b0-e364511bfac2" />



--- 


###  ì‹¤ì‹œê°„ í€´ì¦ˆ ì„¸ì…˜ ìƒíƒœ ì €ì¥ êµ¬ì¡° ([ChallengeSession](https://github.com/dlaudfuf33/quizsushi-be/blob/main/src/main/java/com/cmdlee/quizsushi/quiz/challenge/model/ChallengeSession.java))
ì‹¤ì‹œê°„ í€´ì¦ˆ ì±Œë¦°ì§€ ê¸°ëŠ¥ì— ë¬¸ì œ ì¶œì œ, ìœ ì € ì‘ë‹µ, ì±„íŒ…, ì ìˆ˜ ë“± ê²Œì„ ì§„í–‰ ì¤‘ ë°œìƒí•˜ëŠ” ë‹¤ì–‘í•œ ìƒíƒœë“¤ì„ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ê°€ í•„ìš”í–ˆìŠµë‹ˆë‹¤.   
ì´ ìƒíƒœë“¤ì€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€í™”í•˜ê³  ì—¬ëŸ¬ ìœ ì €ê°€ ë™ì‹œì— ì ‘ê·¼í•˜ë¯€ë¡œ, ë‹¨ìˆœ ì»¬ë ‰ì…˜ ê¸°ë°˜ìœ¼ë¡œëŠ” ì•ˆì •ì„±ì„ í™•ë³´í•˜ê¸° ì–´ë µë‹¤ ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.   

- ê²Œì„ ìƒíƒœ, ì§„í–‰ë¡œê·¸, ì±„íŒ…ë¡œê·¸ë¥¼ ì •í™•í•˜ê²Œ ì €ì¥í•˜ê³  ëˆ„ë½ì´ ì—†ë„ë¡ ì²˜ë¦¬ê°€ í•„ìš”í–ˆìŠµë‹ˆë‹¤.
- ìœ ì €ì˜ ìƒí˜¸ì‘ìš©ì´ ëª°ë¦´ ë•Œì—ë„ í´ë¼ì´ì–¸íŠ¸ì— ì •í™•í•œ ìµœì‹  ìƒíƒœ ì „ì†¡ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤.


- ChallengeSession ê°ì²´ë¥¼ Redisì— JSON í˜•íƒœë¡œ ì €ì¥í•˜ë„ë¡ êµ¬ì¡°ë¥¼ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.
- ë‚´ë¶€ í•„ë“œ ì¤‘ ë™ì‹œ ì ‘ê·¼ ê°€ëŠ¥ì„±ì´ ë†’ì€ ë¦¬ìŠ¤íŠ¸/ë§µ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ë™ì‹œì„± ì œì–´ê°€ ê°€ëŠ¥í•œ ì»¬ë ‰ì…˜ìœ¼ë¡œ êµì²´í•˜ì˜€ìŠµë‹ˆë‹¤:
  ```java
  private Map<String, PlayerStatus> players = new ConcurrentHashMap<>();
  private List<BroadcastMessage> broadcastLog = Collections.synchronizedList(new ArrayList<>());
  private List<ChatMessageRequest> chatLog = Collections.synchronizedList(new ArrayList<>());
  ```

- ì´ êµ¬ì¡°ê°€ ì‹¤ì œë¡œë„ ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ë¥¼ ê²€ì¦í•˜ê¸° ìœ„í•´ ë©€í‹°ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ ë™ì‹œ ì±„íŒ… ì‹œì—ë„ ëª¨ë“  ë©”ì‹œì§€ê°€ ì •í™•íˆ ê¸°ë¡ë˜ëŠ”ì§€ë¥¼ í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.
  ```java
      @DisplayName("ë™ì‹œ ì±„íŒ… ì‹œì—ë„ ëª¨ë“  ë©”ì‹œì§€ê°€ ì •í™•íˆ ê¸°ë¡ëœë‹¤")
    @Test
    void receiveChat_concurrentAccess_shouldHandleWithoutErrors() throws InterruptedException {
        // given
        int threadCount = 10;
        ExecutorService executor = Executors.newFixedThreadPool(10);
        CountDownLatch latch = new CountDownLatch(threadCount);
        String sessionId = "sessionId2025";

        when(challengeSessionRedisService.getSession(sessionId)).thenReturn(testSession);
        for (int i = 0; i < threadCount; i++) {
            QuizsushiMember member = QuizsushiMember.builder()
                    .id((long) i)
                    .nickname("user-" + i)
                    .profileImage("avatar.png")
                    .build();
            PlayerStatus status = new PlayerStatus(member, 100);
            testSession.getPlayers().put(String.valueOf(i), status);
        }

        // when
        for (int i = 0; i < threadCount; i++) {
            final int userNum = i;
            executor.submit(() -> {
                try {
                    ChatMessageRequest message = new ChatMessageRequest();
                    message.setSessionId(sessionId);
                    message.setSenderId(String.valueOf(userNum));
                    message.setNickname("user-" + userNum);
                    message.setContent("í™”ì´íŒ…í•´ìš” " + userNum);
                    challengeGameService.receiveChat(message);
                } finally {
                    latch.countDown();
                }
            });
        }

        latch.await();
        executor.shutdown();

        // then
        List<ChatMessageRequest> logs = testSession.getChatLog();
        assertEquals(threadCount, logs.size(), "ëª¨ë“  ë©”ì‹œì§€ê°€ ëˆ„ë½ ì—†ì´ ê¸°ë¡ë˜ì–´ì•¼ í•¨");

        for (int i = 0; i < threadCount; i++) {
            String expected = "í™”ì´íŒ…í•´ìš” " + i;
            boolean exists = logs.stream().anyMatch(msg -> msg.getContent().equals(expected));
            assertTrue(exists, "ë©”ì‹œì§€ ëˆ„ë½ ì—¬ë¶€ í™•ì¸: " + expected);
        }
    }
  ```
  > 10ëª…ì˜ ì‚¬ìš©ìê°€ ë™ì‹œì— ì±„íŒ…ì„ ì „ì†¡í–ˆì„ ë•Œ ëª¨ë“  ë©”ì‹œì§€ê°€ ëˆ„ë½ ì—†ì´ ë¡œê·¸ì— ì €ì¥ë˜ëŠ”ì§€ë¥¼ ê²€ì¦í–ˆìŠµë‹ˆë‹¤.
  > ì´ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ë™ì‹œ ì ‘ê·¼ ìƒí™©ì—ì„œë„ Collections.synchronizedList êµ¬ì¡°ê°€ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘í•œë‹¤ëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

  <img width="800" height="600" alt="chat" src="https://github.com/user-attachments/assets/f2ce420b-ca1b-4e37-b193-d4814a9afe95" />


---


###  ìë™ ë§¤ì¹­ êµ¬ì¡° ([MatchingQueueService](https://github.com/dlaudfuf33/quizsushi-be/blob/main/src/main/java/com/cmdlee/quizsushi/quiz/challenge/service/MatchingQueueService.java))
ì‹¤ì‹œê°„ í€´ì¦ˆ ì±Œë¦°ì§€ ê¸°ëŠ¥ì—ì„œ, ìœ ì €ê°€ ì°¸ì—¬ë¥¼ ìš”ì²­í•˜ë©´ ì´ë¥¼ ì¼ì • ê¸°ì¤€ì— ë”°ë¼ ìë™ìœ¼ë¡œ ë§¤ì¹­ì‹œì¼œì£¼ëŠ” ë¡œì§ì´ í•„ìš”í–ˆìŠµë‹ˆë‹¤.
- ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë§¤ì¹­ì„ ìš”ì²­í•  ê²½ìš° ëˆ„ê°€ ë¨¼ì € ë“¤ì–´ì™”ëŠ”ì§€ íŒŒì•…í•˜ê³  ê³µì •í•œ ìˆœì„œëŒ€ë¡œ ë§¤ì¹­ì‹œì¼œì•¼ í–ˆìŠµë‹ˆë‹¤.
- ìµœì†Œ 2ëª… ì´ìƒì´ ëª¨ì˜€ì„ ë•Œ ë˜ëŠ” 30ì´ˆ ì´ìƒ ëŒ€ê¸°í•œ ê²½ìš° ì™€ ê°™ì´ ìœ ì—°í•œ ì¡°ê±´ì„ ì„¤ì •í•´ ë§¤ì¹­ì„ ì‹œì‘í•  ìˆ˜ ìˆì–´ì•¼ í–ˆìŠµë‹ˆë‹¤.
- ì´ˆê¸°ì—ëŠ” ì°¸ì—¬ìê°€ ì ì„ ê²ƒì´ê¸° ë•Œë¬¸ì—, í˜¼ìì„œë„ ë„ì „í•  ìˆ˜ ìˆë„ë¡ ì¡°ê±´ì„ ì™„í™”í•˜ì—¬ ë¹ ë¥´ê²Œ ê²Œì„ì„ ì‹œì‘í•  ìˆ˜ ìˆì–´ì•¼ í–ˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ìš”êµ¬ì‚¬í•­ì„ ë‹¨ìˆœí•œ List ë‚˜ SortedSet ì»¬ë ‰ì…˜ ê°™ì€ JVM ë©”ëª¨ë¦¬ ê¸°ë°˜ êµ¬ì¡°ë¡œ ì²˜ë¦¬í•˜ê¸°ì—ëŠ”
- ì„œë²„ ì¸ìŠ¤í„´ìŠ¤ê°€ ì¬ì‹œì‘ë˜ê±°ë‚˜ ë‹¤ì¤‘ ì¸ìŠ¤í„´ìŠ¤ë¡œ í™•ì¥ë  ê²½ìš°, JVM ë‚´ ì»¬ë ‰ì…˜ì€ ìƒíƒœ ê³µìœ ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤
- ì‚½ì… ìˆœì„œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë˜ëœ ìœ ì €ë¥¼ ì¶”ì¶œí•˜ê±°ë‚˜ ì¡°ê±´ì— ë§ëŠ” ìœ ì €ë§Œ ê³¨ë¼ë‚´ê¸° ìœ„í•´ì„œëŠ” ì „ì²´ ìˆœíšŒê°€ í•„ìš”í•˜ë©° ì•½ O(n)

ì´ëŸ¬í•œ ì´ìœ ë¡œ, Redisì˜ Sorted Set(ZSet) ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ êµ¬ì¡°ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
- ìœ ì € ë§¤ì¹­ ë“±ë¡
Redis ZSetì— memberIdë¥¼ keyë¡œ, í˜„ì¬ ì‹œê°„ì„ scoreë¡œ ì €ì¥í•©ë‹ˆë‹¤.
  ```java
    public void enqueue(long memberId) {
          String key = String.valueOf(memberId);
          Boolean exists = redisTemplate.opsForZSet().score(MATCHING_QUEUE_KEY, key) != null;
          if (Boolean.TRUE.equals(exists)) return;
  
          redisTemplate.opsForZSet().add(MATCHING_QUEUE_KEY, key, Instant.now().getEpochSecond());
      }
  ```
  > ì´ë¯¸ ëŒ€ê¸° ì¤‘ì¸ ìœ ì €ëŠ” ì¤‘ë³µ ë“±ë¡ ë°©ì§€ ì‹œê°„ ìˆœ ì •ë ¬ì€ scoreë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì´ë¤„ì§‘ë‹ˆë‹¤.   
  > JVM ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ì´ë¼ë©´ ì‚½ì… ì‹œ ì¤‘ë³µ ì²´í¬ + ì •ë ¬ ë¹„ìš©ì´ í•„ìš”í•˜ì§€ë§Œ, ZSetì€ O(log n)ìœ¼ë¡œ í•´ê²°ë©ë‹ˆë‹¤.

- ì£¼ê¸°ì  ë§¤ì¹­ ê²€ì‚¬   
3ì´ˆë§ˆë‹¤ ì‹¤í–‰ë˜ë©°, ëŒ€ê¸°ì—´ ìƒíƒœë¥¼ ì¡°íšŒí•˜ì—¬ ë§¤ì¹­ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê²½ìš° ì„¸ì…˜ì„ ì‹œì‘í•©ë‹ˆë‹¤.
  ```java
  @Scheduled(fixedRate = 3000)
    public void tryMatch() {
        long now = Instant.now().getEpochSecond();
        Set<ZSetOperations.TypedTuple<String>> matchingPool = redisTemplate.opsForZSet()
                .rangeWithScores(MATCHING_QUEUE_KEY, 0, -1);

        if (matchingPool == null || matchingPool.isEmpty()) return;

        List<String> matched = new ArrayList<>();
        long firstWaited = -1L;
        boolean has30SecWaiter = false;

        for (ZSetOperations.TypedTuple<String> entry : matchingPool) {
            String memberId = entry.getValue();
            messagingTemplate.convertAndSend("/topic/matching/" + memberId,
                    MatchingMessageResponse.from(MatchStatusType.MATCHING));

            Double score = entry.getScore();
            if (memberId == null || score == null) continue;

            long waitedSec = now - score.longValue();
            if (firstWaited == -1) {
                firstWaited = waitedSec;
            }
            if (waitedSec >= 3) {
                has30SecWaiter = true;
            }
            matched.add(memberId);
        }

        boolean canMatchByGroup = matched.size() >= 3 && firstWaited >= 5;
        boolean canMatchByTimeout = has30SecWaiter;

        if (canMatchByGroup || canMatchByTimeout) {
            List<String> toBeMatched = matched.subList(0, Math.min(matched.size(), MAX_PLAYERS));
            toBeMatched.forEach(id -> redisTemplate.opsForZSet().remove(MATCHING_QUEUE_KEY, id));
            try {
                createSession(toBeMatched);
            } catch (GlobalException e) {
                for (String id : toBeMatched) {
                    long memberId = Long.parseLong(id);
                    enqueue(memberId);
                    messagingTemplate.convertAndSend("/topic/matching/" + memberId,
                            MatchingMessageResponse.of(MatchStatusType.MATCHING, null, "í˜„ì¬ ì„¸ì…˜ì´ ê½‰ ì°¼ìŠµë‹ˆë‹¤. ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤."));
                }
            }
        }
    }
  ```
  > ZRANGEë¡œ score ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ëœ ì „ì²´ ëŒ€ê¸°ì—´ì„ ê°€ì ¸ì˜¤ê³  ZREMìœ¼ë¡œ ë§¤ì¹­ëœ ìœ ì €ë¥¼ ì œê±°í•©ë‹ˆë‹¤.   
  > ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ì´ë¼ë©´ ì¡°ê±´ì— ë§ëŠ” ìœ ì € í•„í„°ë§ì— O(n) Redis ZSetì€ ì‚½ì…, ì •ë ¬, ì‚­ì œ ëª¨ë‘ O(log n)

  <img width="800" height="600" alt="match" src="https://github.com/user-attachments/assets/ad87b185-71af-48c1-878a-b93586d84f21" />


  

### AI ì—°ë™ êµ¬ì¡° ê°œì„ 

AI ëª¨ë¸ì„ í™œìš©í•´ í€´ì¦ˆë¥¼ ìƒì„±í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•˜ê³  ìˆìœ¼ë©° ì„œë¹„ìŠ¤ í™˜ê²½ê³¼ ë¹„ìš© ë¬¸ì œë¥¼ ê³ ë ¤í•˜ì—¬ êµ¬ì¡°ë¥¼ ì ì§„ì ìœ¼ë¡œ ê°œì„ í•´ì™”ìŠµë‹ˆë‹¤.   
ì¼ë°˜ í€´ì¦ˆ ìƒì„±ê³¼ ì‹¤ì‹œê°„ ì±Œë¦°ì§€ ë¬¸ì œ ìƒì„±ì€ ìš”êµ¬ ì¡°ê±´ì´ ë‹¤ë¥´ë‹¤ëŠ” ì ì„ ì¸ì§€í•˜ê³ , ê°ê°ì— ìµœì„ ì˜ ì „ëµì„ ì„ íƒí•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.   

1. ë³‘ëª© ë¬¸ì œ ë°œìƒ
QuizSushiì˜ ë°°í¬ í™˜ê²½ì€ ì™¸ì¥ GPUê°€ ì—†ëŠ” ì €ì „ë ¥ ë¯¸ë‹ˆ PCë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ë¡œì»¬ ëª¨ë¸ êµ¬ë™ì‹œ CPU ê¸°ë°˜ ì—°ì‚°ìœ¼ë¡œë§Œ ì‹¤í–‰ë©ë‹ˆë‹¤.
ìš”ì²­ì´ ëª°ë¦¬ë©´ ì§€ì—°ì´ ì‹¬ê°í•´ 10ë¶„ ì´ìƒ ê±¸ë¦¬ëŠ” í˜„ìƒì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.
    <img width="800" height="600" alt="Mermaid Chart - Create complex, visual diagrams with text  A smarter way of creating diagrams -2025-07-24-045206" src="https://github.com/user-attachments/assets/5adc0c2a-1aac-4e0f-a29c-6e9662545d4a" />



2. ìˆ˜í‰ í™•ì¥ ì‹œë„
ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ êµ¬ì¡° ê°œì„ ì„ ê³ ë¯¼í–ˆìŠµë‹ˆë‹¤:
- Ollamaê°€ ìš”ì²­ì„ í•œ ë²ˆì— í•˜ë‚˜ì”©ë§Œ ì²˜ë¦¬í•œë‹¤ë©´ ì—¬ëŸ¬ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë‘ê³  ìš”ì²­ì„ ë‚˜ëˆ„ë©´ ë³‘ëª©ì„ ì¤„ì¼ ìˆ˜ ìˆì§€ ì•Šì„ê¹Œ? ë¼ëŠ” ìƒê°ì„ í–ˆìŠµë‹ˆë‹¤.
  - ë³‘ëª© ë¬¸ì œë¥¼ í•´ì†Œí•˜ê¸° ìœ„í•´, Raspberry Piì— ë¶„ì‚° ë°°í¬í•˜ëŠ” ë°©ì•ˆì„ ì‹¤í—˜í•´ë³´ì•˜ìœ¼ë‚˜ ì´ˆê²½ëŸ‰ ëª¨ë¸ë§Œ êµ¬ë™ì´ ê°€ëŠ¥í–ˆê³ 
  - ë‹¤ìŒìœ¼ë¡œ Docker ê¸°ë°˜ìœ¼ë¡œ ë™ì¼ ë¨¸ì‹  ë‚´ì—ì„œ ì—¬ëŸ¬ Ollama ì»¨í…Œì´ë„ˆë¥¼ ë„ìš°ê³  ë¼ìš´ë“œë¡œë¹ˆì„ ëª¨ë°©í•œ ë°©ì‹ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
    ```java
      @Component
      @RequiredArgsConstructor
      public class AiInstanceRouter {

        private final AiProperties aiProperties;
        private final AtomicInteger index = new AtomicInteger(0);
    
        public String nextUrl() {
            List<String> urls = aiProperties.getUrls();
            int i = index.getAndUpdate(n -> (n + 1) % urls.size());
            return urls.get(i);
        }
      }
    ```
    > ë“±ë¡ëœ Ollama ì¸ìŠ¤í„´ìŠ¤ì˜ ì£¼ì†Œëª©ë¡ì„ ìˆœì„œëŒ€ë¡œ ìˆœíšŒí•˜ë©° ìš”ì²­ì„ ë‚˜ëˆ•ë‹ˆë‹¤.
    <img width="800" height="600" alt="Mermaid Chart - Create complex, visual diagrams with text  A smarter way of creating diagrams -2025-07-24-061839" src="https://github.com/user-attachments/assets/b3cfc9a0-58e1-4051-a485-fa1798889dfc" />

  - êµ¬ì¡°ì ìœ¼ë¡œ ë¶„ì‚°ì€ ê°€ëŠ¥í–ˆì§€ë§Œ, CPU ìì›ì„ ê³µìœ í•˜ëŠ” í•œê³„ë¡œ ì¸í•´ ì»¨í…Œì´ë„ˆ ìˆ˜ë¥¼ ëŠ˜ë ¤ë„ ì„±ëŠ¥ì´ ë¹„ë¡€í•˜ì§€ ì•Šê³  ì˜¤íˆë ¤ ì—­íš¨ê³¼ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

  
3. Geminië¥¼ ë³‘í–‰ ë„ì… ([GeminiAiService](https://github.com/dlaudfuf33/quizsushi-be/blob/main/src/main/java/com/cmdlee/quizsushi/ai/service/GeminiAiService.java))
ì‹¤ì‹œê°„ í€´ì¦ˆ ì±Œë¦°ì§€ ê¸°ëŠ¥ì€ ë¹ ë¥¸ ì‘ë‹µì„±ê³¼ ê³ í’ˆì§ˆ ìƒì„±ì´ í•„ìˆ˜ì˜€ìŠµë‹ˆë‹¤.
CPU ê¸°ë°˜ êµ¬ì¡°ë¡œëŠ” ì´ë¥¼ ë§Œì¡±í•˜ê¸° ì–´ë ¤ì› ê³ , ìˆ˜í‰ í™•ì¥ë„ í•œê³„ì— ë„ë‹¬í–ˆê¸° ë•Œë¬¸ì— Google Vertex AI Geminië¥¼ ë³‘í–‰ ë„ì…í•˜ì˜€ìŠµë‹ˆë‹¤.
- GeminiëŠ” Googleì˜ ë©€í‹°ëª¨ë‹¬ LLMìœ¼ë¡œ, Vertex AI í”Œë«í¼ì„ í†µí•´ API í˜•íƒœë¡œ ì—°ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.   
- í€´ì¦ˆ ì±Œë¦°ì§€ì˜ ë‹¤ìŒ ë¬¸ì œ ìƒì„± ì‹œ, Geminiì—ê²Œ í”„ë¡¬í”„íŠ¸ë¥¼ ì „ë‹¬í•´ ì‹¤ì‹œê°„ìœ¼ë¡œ í€´ì¦ˆë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
  ```java
    public ChallengeQuiz generateChallengeQuizWithGemini(int level) {
          String basePrompt = dbPromptTemplateProvider.getTemplate("quizChallenge_generation_gemini");
          String randomType = QUESTION_TYPES.get(ThreadLocalRandom.current().nextInt(QUESTION_TYPES.size()));
          String finalPrompt = basePrompt.replace("{{randomType}}", randomType)
                  .replace("{{level}}", String.valueOf(level));
  
          for (int attempt = 1; attempt <= MAX_RETRIES; attempt++) {
              try {
                  return callAndParse(finalPrompt);
              } catch (GlobalException e) {
                  log.warn("[GeminiAiService] Attempt {} failed: {}", attempt, e.getMessage());
                  if (attempt == MAX_RETRIES) throw e;
              } catch (Exception e) {
                  log.error("[GeminiAiService] Unexpected error on attempt {}", attempt, e);
                  if (attempt == MAX_RETRIES) throw new GlobalException(ErrorCode.AI_RESPONSE_PARSE_FAILED, e);
              }
          }
  
          throw new GlobalException(ErrorCode.AI_EMPTY_RESPONSE);
      }
  ```
  <img width="800" height="600" alt="Mermaid Chart - Create complex, visual diagrams with text  A smarter way of creating diagrams -2025-07-24-062517" src="https://github.com/user-attachments/assets/60c1237f-cac4-474f-bf4e-98659e4ce321" />




<br>

## ğŸš¦ì£¼ìš” API ëª©ë¡

| Method | Endpoint | ì„¤ëª… |
| :--- | :--- | :--- |
| `POST` | `/api/ai/quizzes/questions` | AIë¥¼ í†µí•´ í€´ì¦ˆ ë¬¸ì œ ìƒì„± |
| `POST` | `/api/quizzes` | ì‚¬ìš©ì í€´ì¦ˆ ìƒì„± |
| `GET` | `/api/quizzes/{id}` | í€´ì¦ˆ ìƒì„¸ ì •ë³´ ì¡°íšŒ |
| `POST` | `/api/quizzes/{id}/results` | í€´ì¦ˆ í’€ì´ ê²°ê³¼ ì œì¶œ |
| `GET` | `/api/auth/{provider}/login` | ì†Œì…œ ë¡œê·¸ì¸ ì‹œì‘ (provider: `google`, `kakao`) |
| `POST` | `/api/auth/logout` | ë¡œê·¸ì•„ì›ƒ |
| `GET` | `/api/members/me` | ë‚´ ì •ë³´ ì¡°íšŒ |
| `Message` | `/matching/join` | (WebSocket) ì±Œë¦°ì§€ ë§¤ì¹­ ì°¸ê°€ |
| `Message` | `/challenge/answer` | (WebSocket) ì±Œë¦°ì§€ ì •ë‹µ ì œì¶œ |
| `GET` | `/cmdlee-qs/dashboard/data` | (ê´€ë¦¬ì) ëŒ€ì‹œë³´ë“œ í†µê³„ ë°ì´í„° ì¡°íšŒ |

<br>

## ğŸ”– ì»¤ë°‹ ê·œì¹™

| íƒ€ì… | ì„¤ëª… |
| :--- | :--- |
| `feat` | ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ ë˜ëŠ” ê¸°ì¡´ ê¸°ëŠ¥ ëª…ì„¸ ë³€ê²½ |
| `fix` | ë²„ê·¸ ìˆ˜ì • ë˜ëŠ” ì˜ë„í•œ ë™ì‘ì´ ì•ˆ ë˜ë˜ ë¶€ë¶„ ìˆ˜ì • |
| `refactor` | ë¦¬íŒ©í† ë§ (ê¸°ëŠ¥ ë³€í™” ì—†ì´ ì½”ë“œ êµ¬ì¡°/í’ˆì§ˆ ê°œì„ ) |
| `chore` | ë¹Œë“œ, ì„¤ì • íŒŒì¼, ì¸í”„ë¼ ê´€ë ¨ ì¡ì¼ |
| `docs` | ë¬¸ì„œ ë˜ëŠ” ì£¼ì„ë§Œ ë³€ê²½í•œ ê²½ìš° |
| `test` | í…ŒìŠ¤íŠ¸ ì½”ë“œ ì¶”ê°€ ë˜ëŠ” ìˆ˜ì • |
| `style` | ì½”ë“œ í¬ë§·íŒ…, ì„¸ë¯¸ì½œë¡ , ê³µë°± ë“± ë³€ê²½ (ê¸°ëŠ¥ ë³€í™” ì—†ìŒ) |
| `perf` | ì„±ëŠ¥ ê°œì„  |
| `ci` | CI ì„¤ì • ë° ê´€ë ¨ ìŠ¤í¬ë¦½íŠ¸ ë³€ê²½ |
